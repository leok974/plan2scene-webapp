{
    "project_name": "plan2scene-webapp",
    "owner": "Leo",
    "goal": "Build a local GPU-powered web app around the official Plan2Scene repository that converts 2D floorplans into 3D scenes and walkthrough videos, with a React frontend and FastAPI backend. The app must actually recompute results for new floorplans when run on a GPU machine.",
    "context": {
        "assignment": {
            "task": "Build a simple web application that converts 2D floorplans into 3D models and generates a walkthrough video, using the Plan2Scene repository.",
            "requirements": [
                "Frontend: React app for uploading a 2D floorplan image and displaying the generated 3D model and walkthrough video.",
                "Backend: Python service integrating Plan2Scene for model generation and video rendering.",
                "Deployment: A working setup that can be run end-to-end. Originally they mentioned 'free resources such as Replit or Railway', but the reviewer has clarified that local GPU deployment + repo + demo video is acceptable.",
                "Deliverables: (1) A GitHub repo (frontend + backend + integration with Plan2Scene), (2) a working local deployment on a GPU machine, (3) an optional live demo, and (4) a video showing the app working on at least one sample floorplan."
            ],
            "reviewer_clarification": {
                "precomputed_results": "Not acceptable as the only behavior. The system must be able to run Plan2Scene on new floorplans when a GPU is available.",
                "offline_generation": "It is okay to generate results offline and deploy, but the code must support real Plan2Scene inference.",
                "gpu_option": "If the deployment option does not have a GPU, they will run the repo themselves on a GPU and try other floorplans.",
                "video_demo": "A video demo of the local deployment working with a sample floorplan is explicitly allowed and encouraged."
            }
        },
        "tech_stack": {
            "backend": "FastAPI (Python)",
            "frontend": "React (Vite + TypeScript)",
            "plan2scene": "Official Plan2Scene repo (added as a submodule or documented sibling clone).",
            "runtime_mode": "Local GPU is the primary deployment target. Free CPU-only deployment is optional."
        },
        "key_decision": "Use Option A: focus on local GPU deployment using Leo's own GPU. The main requirement is that the repo can be cloned and run end-to-end on a GPU machine to process arbitrary new floorplans."
    },
    "architecture": {
        "folders": {
            "root": [
                "README.md",
                "backend/",
                "frontend/",
                "plan2scene/ (submodule or documented external clone)"
            ],
            "backend": [
                "backend/app/main.py (FastAPI entrypoint)",
                "backend/app/schemas.py (Pydantic models)",
                "backend/app/jobs.py (in-memory job store, simple status tracking)",
                "backend/app/plan2scene_integration.py (Plan2Scene wrappers)",
                "backend/static/jobs/ (per-job output: scene + video)",
                "backend/uploads/ (uploaded floorplans)",
                "backend/requirements.txt"
            ],
            "frontend": [
                "frontend/src/App.tsx",
                "frontend/src/api.ts (calls /api/convert and /api/jobs/{job_id})",
                "frontend/src/components/UploadForm.tsx",
                "frontend/src/components/JobStatus.tsx",
                "frontend/src/components/ResultView.tsx",
                "frontend/package.json",
                "frontend/vite.config.ts",
                "frontend/tsconfig.json"
            ]
        },
        "api": {
            "endpoints": [
                {
                    "method": "GET",
                    "path": "/healthz",
                    "description": "Simple health check."
                },
                {
                    "method": "POST",
                    "path": "/api/convert",
                    "description": "Accepts an uploaded floorplan image, creates a job, runs Plan2Scene, and returns a job_id and initial status."
                },
                {
                    "method": "GET",
                    "path": "/api/jobs/{job_id}",
                    "description": "Returns job status and, when done, URLs for the generated 3D scene and walkthrough video."
                },
                {
                    "method": "STATIC",
                    "path": "/static/jobs/{job_id}/...",
                    "description": "Static serving of generated 3D scene (e.g., scene.glb) and walkthrough video (e.g., walkthrough.mp4)."
                }
            ]
        },
        "modes": {
            "primary_mode": "gpu",
            "env_var": "PLAN2SCENE_MODE",
            "values": {
                "gpu": "Default for local GPU deployment. POST /api/convert calls run_plan2scene_local() which must execute the real Plan2Scene pipeline and produce new outputs for each upload.",
                "demo": "Optional CPU/demo mode for quick testing or non-GPU deployments. POST /api/convert may call run_plan2scene_demo(), which can use a simplified or stubbed pipeline, but this mode is not the primary evaluation target."
            }
        }
    },
    "plan2scene_integration": {
        "requirements": [
            "Assume the official Plan2Scene repo is available at ../plan2scene or similar.",
            "Follow the Plan2Scene README to set up the Conda environment, download pretrained models, and configure external tools (e.g., texture synthesis, SmartScenesToolkit).",
            "Implement run_plan2scene_local(upload_path, job_output_dir) in backend/app/plan2scene_integration.py.",
            "Given an uploaded 2D floorplan (and optional additional inputs if needed), run the Plan2Scene pipeline to generate a 3D scene representation and a rendered walkthrough.",
            "Export outputs into job_output_dir as: scene.glb (or scene.json + textures, with a clear format) and walkthrough.mp4 (or another common video format).",
            "Return the paths so the FastAPI layer can expose them under /static/jobs/{job_id}/."
        ],
        "demo_mode": {
            "description": "run_plan2scene_demo(upload_path, job_output_dir) can be implemented as a lightweight stub for local non-GPU testing. It should still create deterministic outputs in job_output_dir so the frontend sees real URLs, but it is not used for final evaluation."
        }
    },
    "frontend_behavior": {
        "flow": [
            "User opens the React frontend.",
            "User selects a floorplan image file.",
            "Frontend sends POST /api/convert with multipart/form-data.",
            "Backend returns { job_id, status }.",
            "Frontend polls GET /api/jobs/{job_id} until status === 'done'.",
            "When done, frontend shows links (and eventually embedded viewer/video) for scene_url and video_url."
        ],
        "minimum_ui": [
            "Upload form with file input and submit button.",
            "Job status display (job id, current status).",
            "Result view that shows scene_url and video_url; a simple <video controls src={video_url}> is sufficient initially.",
            "Nice-to-have: integrate a basic 3D viewer (e.g., Three.js / react-three-fiber) for scene.glb."
        ]
    },
    "tasks_for_agent": [
        {
            "id": "backend-setup",
            "description": "Implement the FastAPI backend skeleton with /healthz, /api/convert, /api/jobs/{job_id}, static file serving under /static, in-memory job tracking, and PLAN2SCENE_MODE switching between run_plan2scene_local and run_plan2scene_demo."
        },
        {
            "id": "plan2scene-local-wrapper",
            "description": "Implement backend/app/plan2scene_integration.py with the correct function signatures. For now, include clear TODO comments and stub subprocess calls to the Plan2Scene repo. The important part is that the structure supports real Plan2Scene execution in gpu mode."
        },
        {
            "id": "frontend-setup",
            "description": "Set up Vite + React + TypeScript frontend under frontend/. Implement App.tsx, api.ts, UploadForm.tsx, JobStatus.tsx, and ResultView.tsx so they can upload a file, receive a job_id, poll status, and show the resulting URLs."
        },
        {
            "id": "end_to_end_gpu_local",
            "description": "Verify that on a local GPU machine (with Plan2Scene installed), running PLAN2SCENE_MODE=gpu and uvicorn + npm run dev/build allows a user to upload a floorplan and obtain fresh outputs. Document all steps in README.md."
        },
        {
            "id": "demo_video_support",
            "description": "Ensure the UI is nice enough for Leo to record a screen capture video demo: clean upload flow, clear status changes, and visible scene/video outputs."
        }
    ],
    "non_goals": [
        "Production-grade cloud GPU deployment is not required for this assignment.",
        "Complex user management, authentication, or rate limiting.",
        "Highly polished 3D editor or complex scene editing tools. Viewing the result is sufficient."
    ]
}